<html>
<head>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<style>
		h1 { text-align: center; }
		p { font-family: sans-serif; }
		circle { stroke: #000000; 
			stroke-opacity: 0.5;
		}
		body {text-align: center;}
		#legendBox { fill: none; 
		stroke: #000000; }
	</style>
	<title>US Marine Pollution</title>
</head>
<body>
	<h1>US Marine Pollution</h1>
	<p>Each circle represents a marine spill reported to the Coast Guard from 2002-2013. The radius of the circles
	is proportional to the logarithm of the size of the spill. </p>
<!-- 	<div id="lineplot"></div> -->
	<div id="map"></div>
	<div id ="gulfmap"></div>
	<script>
    var width=960,height=600,gulfWidth=800,gulfHeight=400,projection=d3.geo.albersUsa(),projectionGulf=d3.geo.albersUsa().scale(5e3).translate([gulfWidth/2-250,gulfHeight/2-800]),path=d3.geo.path().projection(projection),pathGulf=d3.geo.path().projection(projectionGulf),svg=d3.select("#map").append("svg").attr("width",width).attr("height",height).attr("class","svgView"),centerCurr=projection.translate(),svgGulf=d3.select("#gulfmap").append("svg").attr("width",gulfWidth).attr("height",gulfHeight).attr("class","svgView"),g=svg.append("g"),gGulf=svgGulf.append("g"),sizes=[],states=d3.json("us.json",function(a,b){g.append("g").selectAll("path").data(topojson.feature(b,b.objects.states).features).enter().append("path").attr("d",path).style("fill","#dddddd").style("stroke","black").style("stroke-opacity",.33)}),statesGulf=d3.json("us.json",function(a,b){gGulf.append("g").selectAll("path").data(topojson.feature(b,b.objects.states).features).enter().append("path").attr("d",pathGulf).style("fill","#dddddd").style("stroke","black").style("stroke-opacity",.33)}),coords=[];d3.json("pollution.json",function(a,b){var c=d3.scale.log().range([0,6]).base(100);b.data.forEach(function(a){var d,e,f,g,b=a[49];b[1]?(d=[b[2],b[1]],f=a[23],g=a[27]):(d=[a[23],a[22]],f=a[18],g=a[24]),e=projection(d),svgCoordGulf=projectionGulf(d),sizes.push(parseFloat(g));var h;h="OIL"==f?"#0000ff":"CHEMICAL"==f?"#ff0000":"#00ff00";var i="OIL"!=f&&"CHEMICAL"!=f?.5:.15;if(g>0){spillSizeLog=parseFloat(g)+1;var j;e&&(j=c(spillSizeLog),svg.append("circle").attr("cx",e[0]).attr("cy",e[1]).attr("r",j).attr("fill",h).style("fill-opacity",i)),svgCoordGulf&&(j=c(spillSizeLog),svgGulf.append("circle").attr("cx",svgCoordGulf[0]).attr("cy",svgCoordGulf[1]).attr("r",j).attr("fill",h).style("fill-opacity",i))}}),sizes.sort(function(a,b){return b-a})});var myText=["Oil","Chemical","Other"],myColors=["#0000ff","#ff0000","#00ff00"],legend=svg.append("g").attr("x",800).attr("y",200).attr("height",100).attr("width",100),legendBox=legend.append("rect").attr("x",820).attr("y",378).attr("height",72).attr("width",115).attr("id","legendBox"),legendCircle=legend.selectAll("circle").data(myColors);legendCircle.enter().append("circle").attr("cx",840).attr("r",8),legendCircle.attr("cy",function(a,b){return 396+20*b}).style("fill",function(a,b){return myColors[b]});var legendText=legend.selectAll("text").data(myText);legendText.enter().append("text").attr("x",860),legendText.attr("y",function(a,b){return 400+20*b}).text(function(a,b){return myText[b]});var rectX=centerCurr[0]-(gulfWidth/2-250)*(projection.scale()/projectionGulf.scale()),rectY=centerCurr[1]-(gulfHeight/2-800)*(projection.scale()/projectionGulf.scale()),rectHeight=gulfHeight*(projection.scale()/projectionGulf.scale()),rectWidth=gulfWidth*(projection.scale()/projectionGulf.scale());svg.append("rect").attr("x",rectX).attr("y",rectY).attr("width",rectWidth).attr("height",rectHeight).style("fill","none").style("stroke","black"),svg.append("line").attr("x1",rectX).attr("x2",rectX-525).attr("y1",rectY+rectHeight).attr("y2",rectY+rectHeight+200).style("stroke","black"),svg.append("line").attr("x1",rectX+rectWidth).attr("x2",rectX+rectWidth+375).attr("y1",rectY+rectHeight).attr("y2",rectY+rectHeight+200).style("stroke","black"),svgGulf.append("text").attr("x",20).attr("y",30).text("Gulf Coast Inset").attr("font-family","sans-serif").attr("font-size","20px").attr("fill","black");
	</script>
</body>
</html>
